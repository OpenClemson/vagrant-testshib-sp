# vagrant-testshib-sp

Installs a [Shibboleth](http://shibboleth.net/) [service provider](http://shibboleth.net/products/service-provider.html)
and registers it with [Testshib.org](http://www.testshib.org/)'s IdP. Also installs Apache and configures it to require
users to authenticate with Shibboleth.

## Usage

1. The [landrush](http://www.testshib.org/configure.html) Vagrant plugin is required to provide a DNS name for the VM.
   Install it with `vagrant plugin install landrush`.

2. You should set the hostname in `Vagrantfile` to something unique. This will be used to construct the SP's
   SAML [`entityID`](https://wiki.shibboleth.net/confluence/display/CONCEPT/EntityNaming).

3. To bring up the VM, run `vagrant up`. This will install the SP and [configure](http://www.testshib.org/configure.html)
   it with a `shibboleth2.xml` file downloaded from Testshib.

4. Prepare the SP's [metadata](https://wiki.shibboleth.net/confluence/display/CONCEPT/MetadataForSP). The default
   metadata generated by the SP can be obtained by running `curl -k "https://$(hostname)/Shibboleth.sso/Metadata"`
   from the VM. There is a shortcut script for this at `/vagrant/scripts/default-metadata.sh`.

5. Once the metadata is ready, upload it either through [Testshib's website](http://www.testshib.org/register.html)
   or by running `/vagrant/scripts/upload-metadata.sh /path/to/metadata.xml`. Testshib indexes metadata by filename,
   so to make changes to your metadata later you will need to upload it with the same filename (See
   http://www.testshib.org/register.html for more information). The `upload-metadata.sh` script caches the name of
   the metadata file you upload and warns you if you attempt to use a different file name later.

6. After uploading metadata, restart `shibd` and Apache. `systemctl restart shibd && systemctl restart httpd`.

7. Open https://<hostname> in a browser, where hostname is what you set in step 2. You should be redirected to
   Testshib to authenticate.
